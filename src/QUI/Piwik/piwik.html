<script type="text/javascript">
    var _paq = _paq || [];
    _paq.push(["trackPageView"]);
    _paq.push(["enableLinkTracking"]);

    (function () {
        var u = "//{$piwikUrl}/";
        _paq.push(["setTrackerUrl", u + "js/"]);
        _paq.push(["setSiteId", parseInt("{$piwikSideId}")]);

        var d = document, g = d.createElement("script"),
            s               = d.getElementsByTagName("script")[0];

        g.type  = "text/javascript";
        g.async = true;
        g.defer = true;
        g.src   = u + "js/";

        s.parentNode.insertBefore(g, s);
    })();

    if (typeof define === 'function') {
        window.QUIQQER_PIWIK = true;

        define('piwikTracker', function () {
            var Tracker = null;

            var setPiwikData = function () {
                Tracker = Piwik.getAsyncTracker();
                var u   = "//{$piwikUrl}/";

                Tracker.setTrackerUrl(u + "js/");
                Tracker.setSiteId(parseInt("{$piwikSideId}"));

                Tracker.setDocumentTitle(
                    document.domain + "/" + document.title
                );

                Tracker.enableLinkTracking();
            };

            return new Promise(function (resolve) {
                if (typeof window.Piwik !== 'undefined') {
                    setPiwikData();
                    resolve(Tracker);
                    return;
                }

                var look = function () {
                    setTimeout(function () {
                        if (typeof window.Piwik !== 'undefined') {
                            setPiwikData();
                            resolve(Tracker);
                            return;
                        }

                        look();
                    }, 100);
                };

                look();
            });

        });
    }
</script>